<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Blocks</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="css/custom.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <style>
        iframe {
            width: 100%;
            height: 400px;
        }

        .btn {
            margin-bottom: 20px;
        }
    </style>

    <!-- JS -->
    <script src="js/jquery.min.js"></script>
    <script src="js/tether.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    
</head>
<body>
<nav class="navbar navbar-toggleable-md navbar-light bg-faded">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="#">
        <img src="images/talkblok_v1.png" width="30" height="30" style="margin-right: 8px" class="d-inline-block align-top" alt="">
        Talk Blok
    </a>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item ">
                <a class="nav-link" href="./index.html">Home<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="./blocks.html">Blocks</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="./about.html">About</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container">
    <p>The Talk Blok is a way to break barriers and communicate you are willing to talk (if you are willing to talk).  With the green side up select the UPDATE TABLE SHEET button and change the conversation topic for your table.  Need help on writing a good conversation starter?  Consider some of the suggestions below.</p>
    <div style="width: 100%" class="text-center">
        <a href="https://docs.google.com/spreadsheets/d/1PKR2JrO0BOzI7eXbcaXM2ZLFmOj_xS7PA_0FosQ3aJI/edit?usp=sharing" target="_blank">
            <button class="btn btn-lg btn-primary">
                UPDATE TABLE SHEET
            </button>
        </a>
    </div>
    <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRxoexK4XvFX2OLxWfguli-F-H1uVAibJHGIBKJtTJvOU7OgnGy6rsqrxayi0SLHHVsDhBxnGXktlrx/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    <div style="width: 100%" class="text-center">
        <a href="https://docs.google.com/spreadsheets/d/1PKR2JrO0BOzI7eXbcaXM2ZLFmOj_xS7PA_0FosQ3aJI/edit?usp=sharing" target="_blank">
            <button class="btn btn-lg btn-primary" style="margin-top: 10px">
                UPDATE TABLE SHEET
            </button>
        </a>
    </div>
</div>
<!--<div class="container">-->
    <!--<section id="blockSelect">-->
        <!--<div class="row">-->
            <!--<h3>What block are you on?</h3>-->
            <!--<select name="" id="placeSelect" class="form-control">-->
                <!--<option value="cougarEar">Cougar Eat</option>-->
                <!--<option value="pendulumCourt">Pendulum Court</option>-->
                <!--<option value="moaCafe">Moa Cafe</option>-->
            <!--</select>-->
        <!--</div>-->
    <!--</section>-->
    <!--<section>-->
        <!--<iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRxoexK4XvFX2OLxWfguli-F-H1uVAibJHGIBKJtTJvOU7OgnGy6rsqrxayi0SLHHVsDhBxnGXktlrx/pubhtml?gid=0&amp;single=true&amp;widget=true&amp;headers=false"></iframe>-->
    <!--</section>-->
    <!--<section id="blockTable">-->
        <!--<div class="row">-->
            <!--<table class="table">-->
                <!--<thead>-->
                <!--<tr>-->
                    <!--<th>Table #</th>-->
                    <!--<th>Name</th>-->
                    <!--<th>Ice Breaker</th>-->
                    <!--<th>Time Remaining</th>-->
                    <!--<th>Join</th>-->
                <!--</tr>-->
                <!--</thead>-->
                <!--<tbody class="place">-->

                <!--</tbody>-->
            <!--</table>-->
        <!--</div>-->
    <!--</section>-->
<!--</div>-->

<div class="container">

    <div>
        <p><b>Here are some strategies to try when your mind is a blank:</b></p>
        <p>1. <b>Comment on a topic common to both of you at the moment</b></p>
        <p>2. <b> Comment on a topic of general interest</b></p>
        <p>3. <b>Ask open questions that can’t be answered with a single word</b></p>
        <p>4. If you do ask a question that can be answered in a single word, instead of just supplying your own information in response, <b>ask a follow-up question</b></p>
        <p>5. <b>Ask getting-to-know-you questions</b></p>
        <p>6. <b>React to what a person says</b></p>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="blockModalBody">
                <form action="#">
                    <div class="form-group">
                        <h3>Block </h3>
                    </div>
                    <div class="form-group">
                        <label for="name">What's your name or nickname?</label>
                        <input type="text" id="name" class="form-control" placeholder="ex. Dan the man" required>
                    </div>
                    <div class="form-group">
                        <label for="iceBreaker">Ice Breaker, you need to start somewhere.</label>
                        <input list="iceBreakers" id="iceBreaker" class="form-control" placeholder="ex. Why eat here?" required>
                        <datalist id="iceBreakers">
                            <option value="What three words best describe you?">
                            <option value="What movie would be greatly improved if it was made into a musical?">
                            <option value="If your five-year-old self suddenly found themselves inhabiting your current body, what would your five-year-old self do first?">
                            <option value="What is something that everyone looks stupid doing?">
                            <option value="What is your favorite class?">
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label for="time">How long will you be here?</label>
                        <select class="form-control" id="time">
                            <option>5 min</option>
                            <option>10 min</option>
                            <option>15 min</option>
                            <option>20 min</option>
                            <option>30 min</option>
                        </select>
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="blockModalBtn" data-block="">Post table</button>
            </div>
        </div>
    </div>
</div>

<script>
    let blocks = [
        {
            "location": "Cougar Eat",
            "coordinates": {
                "ltd": 40.248212,
                "lng": -111.647511
            },
            "blocks": [
                {
                    "blockNum": 1,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 2,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 3,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 4,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 5,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 6,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                }
            ]
        },
        {
            "location": "Pendulum Court",
            "coordinates": {
                "ltd": 40.248212,
                "lng": -111.647511
            },
            "blocks": [
                {
                    "blockNum": 1,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 2,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 3,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 4,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 5,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                },
                {
                    "blockNum": 6,
                    "name": "",
                    "iceBreaker": "",
                    "time": 0
                }
            ]
        }

    ];

    $(document).ready(function () {

        // General startup
//        if ("geolocation" in navigator) {
//            navigator.geolocation.getCurrentPosition(function(position) {
//                console.log(distance(position.coords.latitude, position.coords.longitude, blocks[1].coordinates.ltd, blocks[1].coordinates.ltd));
//            });
//        } else {
//            /* geolocation IS NOT available */
//        }

        // General setup of the table, assumes you are in the cougar eat
        let tableContents = ``;
        blocks[0].blocks.forEach(function (blk) {
            tableContents += `
                <tr id="block-${blk.blockNum}">
                    <th scope="row">${blk.blockNum}</th>
                    <td>${blk.name}</td>
                    <td>${blk.iceBreaker}</td>
                    <td>${blk.time}</td>
                    <td><buttom class="btn btn-sm btn-primary editBlock" data-block="${blk.blockNum}"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i></buttom></td>
                </tr>
            `;
        });

        $('#blockTable tbody').empty();
        $('#blockTable tbody').append(tableContents);


        // Navigating to website from block
        let blockId  = window.location.search.match(/_id=([^&]*)/)[1];

        if (blockId) {
            let block = $('#block-' + blockId);
            $('#blockModalBody h3').text('Block ' + blockId);
            $('#blockModalBtn').attr('data-block', blockId);
            console.log($(block[0].cells[1]).text());
            $("#myModal").modal();
        }

    });

    $(document).on('click', '.editBlock', function () {
        let id = $(this).data('block');

        let block = blocks[0].blocks.find(function (bkl) {
            console.log(id);
            return bkl.blockNum == id;
        });

        $('#blockModalBody h3').text('Block ' + id);
        $('#blockModalBtn').attr('data-hmm', id);
        $('#name').val(block.name);
        $('#iceBreaker').val(block.iceBreaker);
        $('#time').val(block.time);

        $('#myModal').modal('toggle');
    });

    $('#blockModalBtn').on('click', function () {
        console.log($(this));
        let blockId = $(this).data('hmm');

        console.log(blockId);

        let block = $('#block-' + blockId);

        // name
        $(block[0].cells[1]).text($('#name').val());
        // ice breaker
        $(block[0].cells[2]).text($('#iceBreaker').val());
        // time
        $(block[0].cells[3]).text($('#time').val());

        $("#myModal").modal('toggle');
    });

    $('#placeSelect').on('change', function () {
        let id = $(this).val();
        $('.place').addClass('hidden');
        $('#' + id).removeClass('hidden');

    });

    // Distance from location code
    function distance( lat1, lon1, lat2, lon2) {
        let R = 6371; // Radius of the earth in km
        let dLat = (lat2-lat1).toRad();  // Javascript functions in radians
        let dLon = (lon2-lon1).toRad();
        let a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
        let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        let d = R * c; // Distance in km
        return d;
    }

    /** Converts numeric degrees to radians */
    if (typeof(Number.prototype.toRad) === "undefined") {
        Number.prototype.toRad = function() {
            return this * Math.PI / 180;
        }
    }


</script>
</body>
</html>